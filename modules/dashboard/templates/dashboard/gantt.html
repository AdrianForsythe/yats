{% extends "dashboard/base.html" %}
{% load static %}

{% block title %}Gantt Chart - YATS{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1><i class="fas fa-project-diagram"></i> Project Timeline</h1>
        <p>Interactive Gantt chart for project management and task scheduling</p>
    </div>

    <div class="gantt-container">
        <div id="gantt_here" style='width:100%; height:600px;'></div>
    </div>
</div>

<script src="{% static "dashboard/gantt/dhtmlxgantt.js" %}" type="text/javascript"></script>
<link rel="stylesheet" href="{% static "dashboard/gantt/dhtmlxgantt.css" %}" />

<script>
gantt.config.date_format = "%Y-%m-%d %H:%i";
gantt.config.order_branch = "marker";
gantt.config.order_branch_free = true;
gantt.config.open_tree_initially = true;

gantt.attachEvent("onLoadEnd", function() {
    gantt.batchUpdate(function() {
        gantt.sort("sort_order", false)
    })
});

gantt.attachEvent("onRowDragEnd", function(id, target) {
    //update the order of tasks
    gantt.batchUpdate(function() {
        gantt.eachTask(function(task) {
            task.sort_order = task.$local_index + 1;
            gantt.updateTask(task.id)
        })
    })
});

gantt.attachEvent("onBeforeTaskAdd", function(id, task) {
    task.sort_order = task.$local_index + 1;
    return true;
});

gantt.init("gantt_here");
gantt.load("/dashboard/gantt/data/", "json");

var dp = new gantt.dataProcessor("/dashboard/gantt/data/");
dp.init(gantt);
dp.setTransactionMode("REST");
</script>

<style>
.gantt-container {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 20px;
    margin-top: 20px;
}

.dashboard-header {
    margin-bottom: 20px;
}

.dashboard-header h1 {
    color: #2c3e50;
    margin-bottom: 10px;
}

.dashboard-header p {
    color: #7f8c8d;
    font-size: 16px;
}
</style>
{% endblock %}
